<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style.css">
<title>Questionnaire</title>
</head>
<body>
  
  <input id="questionId" type="hidden" value=<%- questionId %>>

  <div class="header">
    <a href="/logout" id="logout">Déconnexion</a>
    <div id="timer">Temps restant : <span id="countdown">30:00</span></div>
  </div>  
  <h1>Questionnaire sur <%= title %> </h1>
  <form action="/calculate" method="post">
    <ol>
      <li>
        <% if(blogs.length > 0 ) { %>
            <% blogs.forEach((blog, index) => { %>
        <h3 class="title"><%= index + 1 %>.<%= blog.title %> </h3>
        <input type="radio" name="<%= blog._id %>" value=<%= blog.q1 %> > <%= blog.q1 %> <br>
        <input type="radio" name="<%= blog._id %>" value=<%= blog.q2 %> > <%= blog.q2 %> <br>
        <input type="radio" name="<%= blog._id %>" value=<%= blog.q3 %> > <%= blog.q3 %> <br>
        <input type="radio" name="<%= blog._id %>" value=<%= blog.q4 %> > <%= blog.q4 %><br>
            <% }) %>
        <% } %>
      </li>
    </ol>
    <input type="submit" value="Soumettre" >
  </form>


  <script>
    // Fonctionnalité du compte à rebours
    const countdownElement = document.getElementById("countdown");
    let timeLeft = 30 * 60; // 30 minutes en secondes
  
    function updateTimerDisplay() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      countdownElement.textContent = `${minutes}:${seconds.toString().padStart(2, "0")}`;
    }
  
    function countdown() {
      if (timeLeft > 0) {
        timeLeft--;
        updateTimerDisplay();
      } else {
        // Le temps est écoulé, effectuez des actions ici (par exemple, soumettez le formulaire)
        alert("Temps écoulé !");
      }
    }
  
    // Démarrer le compte à rebours
    updateTimerDisplay();
    setInterval(countdown, 1000); // Mettre à jour toutes les secondes
  
    // Fonctionnalité du bouton de déconnexion
    const logoutButton = document.getElementById("logout");
    logoutButton.addEventListener("click", () => {
      // Effectuez les actions de déconnexion ici
      alert("Déconnexion cliquée !");
    });

    const form = document.querySelector('form');
    form.addEventListener('submit', e => {
      e.preventDefault();
      const formData = new FormData(form);
      const questions = [];
      
      formData.forEach((v, k) => {
        questions.push({ questioonId: k, answer: v });
      });

      const questionId = document.querySelector('#questionId').value;
      
      fetch('/calculate', {
        method: 'POST',
        body: JSON.stringify({ questionId , questions }),
        headers: { 'Content-Type': 'application/json' }
      }).then(res => console.log({ res })).catch(err => console.log({ err }));

    })
  </script>
  
</body>
</html>
